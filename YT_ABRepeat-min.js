class yt_ABRepeat{constructor(){let t;const e=$("#videoID"),a=document.getElementById("abr_enable"),n=document.getElementById("abr_count_num"),o=$("#abr_A_input"),l=$("#abr_B_input"),i=$("#abr_state"),s=0,r=1,c=2,u=3,d=4;let b,p=-1,m=-1,y=s,_=-1,f=1;this.loadVideo=function(a){a||(a=e.val()),t&&t.destroy(),t=new YT.Player("player",{height:"100%",width:"100%",videoId:a,playerVars:{playsinline:1,autoplay:0,rel:0},events:{onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}})},this.onPlayerReady=function(){f=1,R(0),S(0),I(),k()},this.onPlayerStateChange=function(e){if(e.data==YT.PlayerState.PLAYING)a.checked&&A();else if(e.data==YT.PlayerState.ENDED){const e=t.getDuration()-.6;y==u&&m>=e?(f--,S(e,!0),w()):(t.pauseVideo(),t.seekTo(e,!0))}else e.data==YT.PlayerState.BUFFERING||T()},this.enableChanged=function(e){t.getPlayerState()==YT.PlayerState.PLAYING&&(e?A():T())},this.setTimes=function(t){return t=Math.floor(t),_=t=t<-1?-1:t,t};let g="",h="";function v(t){const e=t.split(":",3),a=e.length;return(parseFloat(e[0])||0)*Math.pow(60,a-1)+(parseFloat(e[1])||0)*Math.pow(60,a-2)+(parseFloat(e[2])||0)*Math.pow(60,a-3)}function B(t){const e=t%60;let a=e.toString().split(".");a[0]=a[0].padStart(2,"0");return((t-e)/60).toFixed()+":"+a.join(".")}function A(){y!=s&&y!=u&&(y!=r&&y!=d||(f=m-t.getCurrentTime()<1?0:1),y=u,b=setInterval(w,200),n.innerText=f,i.text("AB重複正在運行中"))}function T(){y!=u&&y!=d||(clearInterval(b),y==u?(y=c,i.html("AB重複已停止運行")):i.html("已完成&nbsp;"+f+"&nbsp;次播放"))}function w(){const e=t.getCurrentTime();e<p?t.seekTo(p,!0):e>=m&&(f<_||_<1?(t.seekTo(p,!0),f++,n.innerText=f):(y=d,t.pauseVideo(),t.seekTo(m,!0)))}function k(){R(0);const e=t.getPlayerState()==YT.PlayerState.CUED?1:.6;S(t.getDuration()-e)}function I(){p<m?y==s&&(y=r,i.html("AB點已設定"),a.checked&&t.getPlayerState()==YT.PlayerState.PLAYING&&A()):(clearInterval(b),y=s,i.html("AB點無效")),n.innerText=f}function R(t){t<0&&(t=0),p!=t&&(p=t,g=B(t),f=1,I()),o.val(g)}function S(e,a){if(e<0&&(e=0),m!=e){let n=t.getDuration();n>0&&e>n-.6&&(e=n-.6),m!=e&&(m=e,h=B(e),a||(f=1),I())}l.val(h)}this.confirmASecs=function(){R(v(o.val()))},this.confirmBSecs=function(){S(v(l.val()))},this.repeatWholeVideo=k,this.flagA=function(){R(t.getCurrentTime())},this.flagB=function(){S(t.getCurrentTime())},this.gotoA=function(){t.seekTo(p,!0)},this.gotoB=function(){t.seekTo(m,!0)}}}{let t=document.getElementById("AB_Repeat_usage");t&&(t.outerHTML='\n<div class="abr_usage">【使用說明】 <button onclick="$(\'#說明\').toggle(600);">展開閱讀</button><ul id="說明" style="margin:0 0 0 2em; display: none;"><li>先從【選取影片】中，選取想要觀看的影片。</li><li>在【次數】中輸入想要重複的次數。低於 1 次的話，表示無限重複。</li><li>在ＡＢ點欄位輸入想要循環重複的時間範圍，Ａ必須小於Ｂ。</li><li><button type="button" class="tool_btn flag"></button>可以將Ａ或Ｂ時間點設定成目前播放位置。</li><li><button type="button" class="tool_btn rocket"></button>可以讓播放位置立刻跳到Ａ或Ｂ點。</li><li><button type="button" class="ctrl"><svg class="power-icon" style="height: 1em; width:1em;"><use href="#svg-power-icon" /></svg></button>開啟或關閉ＡＢ重複功能。</li><li><button type="button" class="ctrl">重複全片</button>可以將ＡＢ範圍設定成整個影片全部。</li><li>其他如：播放、暫停、音量、速度、全螢幕等等功能，請透由YouTube的影片控制項操作。</li><li>AB重複正在運行時，你沒有辦法將播放位置移到AB範圍之外。如果想要擴展AB位置，可以「直接輸入新的時間值」或者先「按電源鍵關閉AB功能」再尋找適當的AB點。</li></ul></div>\n'),t=document.getElementById("AB_Repeat"),t&&(t.outerHTML='\n<svg style="display: none" version="2.0"><defs><symbol id="svg-power-icon" viewBox="0 0 200 200"><path d="M156.31 43.63a9.9 9.9 0 0 0-14 14 60.1 60.1 0 1 1-85 0 9.9 9.9 0 0 0-14-14c-31 31-31 82 0 113s82 31 113 0a79.37 79.37 0 0 0 0-113Zm-56.5 66.5a10 10 0 0 0 10-10v-70a10 10 0 0 0-20 0v70a10 10 0 0 0 10 10Z" /></symbol></defs></svg><form class="abr_form" onsubmit="my_ytABRepeat.confirmASecs(); my_ytABRepeat.confirmBSecs(); return false;"><input type="checkbox" name="abr_enable" id="abr_enable" checked onchange="my_ytABRepeat.enableChanged(this.checked);" hidden><div class="flexBlock"><div class="flaxItem"><button type="button" class="power-btn ctrl" onclick="document.getElementById(\'abr_enable\').click();"><span class="power-icon-ray"></span><svg class="power-icon"><use href="#svg-power-icon" /></svg></button></div><div class="flaxItem"><div class="flaxItem"><table class="abr_table"><tr><td class="nowrap"><label for="abr_times">次數:&nbsp;</label></td><td><input type="number" name="abr_times" id="abr_times" min="-1" list="defaultNumbers" value="-1" class="input_field ctrl" onchange="this.value=my_ytABRepeat.setTimes(this.value);"><datalist id="defaultNumbers"><option value="-1">無限 <option value="5"><option value="10"><option value="20"><option value="50"><option value="100"></datalist></td></tr></table><span id="abr_show_count" class="nowrap" style="min-width: 3em;">第&nbsp;<span id="abr_count_num">0</span>&nbsp;次</span></div><div class="flexBlock"><div class="flaxItem"><table class="abr_table"><tr><td class="nowrap"><label for="abr_A_input">Ａ點:&nbsp;</label></td><td><input name="abr_A_input" id="abr_A_input" class="input_field" onchange="my_ytABRepeat.confirmASecs();"></td></tr><tr><td></td><td><button id="setAtoCurrent" type="button" class="tool_btn flag" onclick="my_ytABRepeat.flagA();"></button><button id="gotoA" type="button" class="tool_btn rocket" onclick="my_ytABRepeat.gotoA();"></button></td></tr></table></div><div class="flaxItem"><table class="abr_table"><tr><td class="nowrap"><label for="abr_B_input">Ｂ點:&nbsp;</label></td><td><input name="abr_B_input" id="abr_B_input" class="input_field" onchange="my_ytABRepeat.confirmBSecs();"></td></tr><tr><td></td><td><button id="setBtoCurrent" type="button" class="tool_btn flag" onclick="my_ytABRepeat.flagB();"></button><button id="gotoB" type="button" class="tool_btn rocket" onclick="my_ytABRepeat.gotoB();"></button></td></tr></table></div><div class="flaxItem"><button id="abr_repeat_whole" type="button" class="ctrl" onclick="my_ytABRepeat.repeatWholeVideo();" style="margin-right: 0;">重複全片</button><br><div id="abr_state" class="msg-box"></div></div></div></div></div><input type="submit" hidden></form>\n')}var my_ytABRepeat=new yt_ABRepeat;{const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}function onYouTubeIframeAPIReady(){my_ytABRepeat.loadVideo()}